<!doctype html>
<html class="no-js" lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Hugo 0.78.1" />

  <title> DOOM에서 배우는 각도 표현하는 방법과 sin, cos 구현법 &middot; /usr/lib/libsora.so </title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="naver-site-verification" content="2ddc1a56777489f4a64a4f6a59822f8b1c1ea502"/>
  <meta name="google-site-verification" content="VsvNNnJZUV-iLEYKNju16p-HtDqZeqL15H-VVy-HwpA" />

  <meta name="gc:client-id" content="785d47c81cbc2fd42b65">
  <meta name="gc:client-secret" content="5e5d558f0b16fae154aa47fc9d94f7c09e540ec7">

  
  <meta name="author" content="if1live" />
  

  
  <meta name="description" content="DOOM에서 배우는 각도 표현하는 방법과 sin, cos 구현법" />
  

  
  <meta name="keywords" content="fixed point, sine, angle" />
  

  
  
<meta name="twitter:card" content="summary">
<meta name="og:url" content="https://libsora.so/posts/angle-and-sine-doom-version/">

<meta name="twitter:site" content="@if1live">


<meta name="twitter:title" content="DOOM에서 배우는 각도 표현하는 방법과 sin, cos 구현법">
<meta name="twitter:description" content="개요 최근 고정 소수점 기반으로 게임을 만들고 있다. 요즘에서는 고정 소수점이 일종의 잃어버린 기술가 되어서 참고할 자료가 많지 않더라. Fixed-point arithmetic를 읽어보다 DOOM이 보여서 둠은 어떤식으로 구현했나 코드를 뒤져봤다.
 Doom was the last first-person shooter title by id Software">

<meta name="twitter:image:src" content="https://www.gravatar.com/avatar/fb9672e7e0d256f39369595381d1ea07">



  

  
  
  <link rel="stylesheet" href="https://libsora.so/css/style-gen.css?2">

  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  
  <link href="https://libsora.so/index.xml" rel="alternate" type="application/rss+xml" title="/usr/lib/libsora.so" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism.min.css"
  integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ=="
  crossorigin="anonymous" />
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/line-numbers/prism-line-numbers.min.css"
  integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ=="
  crossorigin="anonymous" />

  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css"
  integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw=="
  crossorigin="anonymous" />


  
  <script type="text/javascript">
    var host = "libsora.so";
    if ((host == window.location.host) && (window.location.protocol != "https:")) {
      window.location.protocol = "https";
    } else {
      console.log("skip https redirect");
    }
  </script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: "ca-pub-3043297488880636",
  enable_page_level_ads: true
});
</script>

</head>
<body>

<header class="header">
  <h1 class="font-monospace">
    <a href="https://libsora.so/">/usr/lib/libsora.so</a>
  </h1>
  <nav>
    <h2 hidden>Navigation</h2>
    <ul class="nav-link-list">
      <li>
        <a href="https://libsora.so/about/"  title="about">
          <i class="fa fa-info"><span hidden>about</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/projects/"  title="projects">
          <i class="fa fa-code"><span hidden>projects</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/archives/"  title="archives">
          <i class="fa fa-archive"><span hidden>Archives</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/tags/"  title="tags">
          <i class="fa fa-tags"><span hidden>Tags</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/search/"  title="search">
          <i class="fa fa-search"><span hidden>Search</span></i>
        </a>
      </li>
    </ul>
  </nav>
</header>


<div class="container">
  <article class="basic-content article-content">
    <header>
      <hgroup class="entry-title">
        <a href="/posts/angle-and-sine-doom-version/" rel="bookmark" title="Permalink to DOOM에서 배우는 각도 표현하는 방법과 sin, cos 구현법">
          <h1>DOOM에서 배우는 각도 표현하는 방법과 sin, cos 구현법</h1>
          
          <h2>386, 486 에서도 돌아가는 sin, cos</h2>
          
        </a>
      </hgroup>
    </header>

    <footer class="post-info">
      <abbr class="published" title='2016-05-06T00:00:00Z'>
        2016/05/06
      </abbr>
      
      <address class="vcard author">
        By <a href="//twitter.com/if1live">@if1live</a>
      </address>
      

      <ul class="list-of-tags tags-in-article">
        
        <li>
          <a href="/tags/fixed-point">#fixed point</a>
        </li>
        
        <li>
          <a href="/tags/sine">#sine</a>
        </li>
        
        <li>
          <a href="/tags/angle">#angle</a>
        </li>
        
      </ul>
    </footer>

    <section class="entry-content">
      <h2 id="개요">개요</h2>
<p>최근 고정 소수점 기반으로 게임을 만들고 있다.
요즘에서는 고정 소수점이 일종의 <a href="https://namu.wiki/w/%EB%A1%9C%EC%8A%A4%ED%8A%B8%20%ED%85%8C%ED%81%AC%EB%86%80%EB%9F%AC%EC%A7%80">잃어버린 기술</a>가 되어서 참고할 자료가 많지 않더라.
<a href="https://en.wikipedia.org/wiki/Fixed-point_arithmetic">Fixed-point arithmetic</a>를 읽어보다 DOOM이 보여서 둠은 어떤식으로 구현했나 코드를 뒤져봤다.</p>
<blockquote>
<p>Doom was the last first-person shooter title by id Software
to use a 16.16 fixed point representation for all of its non-integer computations,
including map system, geometry, rendering, player movement etc.
This was done in order for the game to be playable on 386 and 486SX CPUs without an FPU.
For compatibility reasons, this representation is still used in modern Doom source ports.</p>
</blockquote>
<h2 id="binary-angle-measurement-bam">Binary Angle Measurement (BAM)</h2>
<p>각도는 일반적인 정수/부동소수 연산과 다르다. 가장 큰 차이점이라면 주기가 있다는 점이다.
0도, 360도, 720도, &hellip;는 전부 같은 각도이다. 그래서 각도의 사칙연산을 수행한 다음에는 원하는 범위로 보정하기도 한다.</p>
<p><a href="https://bitbucket.org/se5a/fixmath.net/src/46f109457efaf6821c26ee991a0bc69d81b3ed63/Fix16.cs?fileviewer=file-view-default#Fix16.cs-390:409">FixMath.NET - Fix16.cs</a></p>
<p>아래의 코드는 FixMath.NET의 Sine 함수이다. 인자로 넘어온 각도가 일정 범위를 벗어나지 않도록 보정하는 코드가 포함되어 있다.</p>
<pre><code class="language-csharp">public static Fix16 Sin(Fix16 inAngle) {
    var tempAngle = inAngle % (Pi &lt;&lt; 1);

    if (tempAngle &lt; Zero)
        tempAngle += Pi &lt;&lt; 1;

    if (tempAngle &gt;= Pi) {
        tempAngle -= Pi;
        if (tempAngle &gt;= (Pi &gt;&gt; 1))
            tempAngle = Pi - tempAngle;
        ...
    }
    if (tempAngle &gt;= (Pi &gt;&gt; 1))
        tempAngle = Pi - tempAngle;
    ....
}
</code></pre>
<p>이로 인해 int, float를 그대로 각도로 쓰면 몇가지 문제점이 있다.</p>
<ul>
<li>일점 범위를 벗어나지 않도록 값을 확인하고 보정해야 한다.
<ul>
<li>예: 180도 + 181도 = 361도, 361도는 0~360도에서 벗어났기때문에 360을 빼서 1도로 바꿈</li>
</ul>
</li>
<li>int, float 표현범위상에 중복되는 각도가 존재한다. 매우 정밀한 각도라고 말할 수 없다
<ul>
<li>예: int(0) == int(360) == int(720) &hellip;</li>
<li>예: float(0) == float(2PI) == float(4PI) &hellip;</li>
</ul>
</li>
</ul>
<p>DOOM에서는 <a href="https://en.wikipedia.org/wiki/Binary_scaling">Binary Angle Measurement (BAM)</a> 이라는 기법을 이용해서 위의 문제를 해결했다.
<a href="https://github.com/id-Software/DOOM/blob/master/linuxdoom-1.10/tables.h">코드</a>는 다음과 같다.</p>
<pre><code class="language-c">// Binary Angle Measument, BAM.
#define ANG45			0x20000000
#define ANG90			0x40000000
#define ANG180		0x80000000
#define ANG270		0xc0000000

typedef unsigned angle_t;
</code></pre>
<ol>
<li>각도를 표현할 목적의 새로운 타입을 정의했다. 이를 <code>angle_t</code>라고 부르며 <code>unsigned int</code>와 동일하다.</li>
<li>0도=<code>0x0</code>, 359.999999&hellip;도=<code>0xffffffff</code> 으로 맵핑한다.</li>
</ol>
<p>BAM 기법을 이용하면 각도가 일정 범위에서 벗어나지 않도록 보정할 필요가 없다.
각도의 사칙 연산도중에 범위를 벗어나는 각도(-24도, 730도)가 나오면 오버플로우에 의해서 올바른 범위로 알아서 보정된다.
예를 들어 180도(<code>0x8000 0000</code>)와 270도(<code>0xc000 0000</code>)를 더하면 450도(<code>0x1 4000 0000</code>)가 될텐데 오버플로우에 의해서 앞자리가 사라지고 90도(<code>0x4000 0000</code>)가 된다.</p>
<p>또한 매우 높은 정밀도로 각도를 표현할수 있다.
<code>0x0</code> ~ <code>0xffffffff</code>는 모두 다른 각도를 표현한다. 4바이트를 전부 사용해서 정밀하게 각도를 표현할수 있다.</p>
<h2 id="sin">sin()</h2>
<p>lookup table을 이용하면 sine을 구현할수 있다. 그런데 lookup table은 어떻게 만들것인가?
DOOM의 BAM은 잊고 360도 세상에서 sine lookup table을 구현해보자.</p>
<p>가장 간단한 방법은 크기 360의 배열을 만들어서 sine을 저장하는 것이다.
룩업 테이블에서의 인덱스는 <code>(int)(degree * 1)</code>이다.</p>
<ul>
<li>0 ~ 0.9999도 = sine_table[0]</li>
<li>1 ~ 1.9999도 = sine_table[1]</li>
<li>&hellip;</li>
</ul>
<p>구현해놓고 써보니까 sine값 360개로는 정밀도가 낮더라. 조금더 높은 정밀도를 얻으려면 어떻게 하면 될까?
제일 단순한 방법은 테이블을 크게 만드는거다. 룩업 테이블의 크기를 3600으로 올려보자.
이때 룩업 테이블에서의 인덱스는 <code>(int)(degree * 10)</code>이다.</p>
<ul>
<li>0.0 ~ 0.0999도 = sine_table[0]</li>
<li>0.1 ~ 0.1999도 = sine_table[1]</li>
<li>0.2 ~ 0.2999도 = sine_table[2]</li>
<li>&hellip;</li>
</ul>
<p>룩업 테이블의 크기가 10개 커지면 각도 구간을 10배 더 자세하게 표현할 수 있다.
각도에서 소수점 x번째 자리까지의 값을 이용하면 룩업 테이블에서의 인덱스를 얻을수 있다.</p>
<p>이 방법을 그대로 Binary Angle Measurement 적용해보자.
32bit unsigned int를 13bit + 19bit로 나눈다.
상위 13bit를 룩업 테이블에서의 인덱스로 사용한다.
sine lookup table의 크기는 8192(2 ** 13)이다.
만약 더 정밀한 sine lookup table을 얻고싶으면 13비트 대신 14bit를 쓰면 되는거다.</p>
<pre><code class="language-c">// table.h
#define FINEANGLES		8192
#define FINEMASK		(FINEANGLES-1)

// 0x100000000 to 0x2000
#define ANGLETOFINESHIFT	19

// Effective size is 10240.
extern  fixed_t		finesine[5*FINEANGLES/4];
</code></pre>
<p>lookup table에서 sine을 계산하고 싶은 각도 앞뒤의 sine값을 얻은 다음 적절히 보간하는 방법도 있겠지만 486에서는 그런 사치를 부리지 못하나보다.
DOOM에서 sine이 사용된 코드를 보면 BAM에 shift 연산을 적용한 다음 룩업 테이블을 조회한다. 추가 계산? 보간? 그런거 없더라.</p>
<pre><code class="language-c">// r_segs.c
sineval = finesine[offsetangle &gt;&gt;ANGLETOFINESHIFT];
</code></pre>
<h2 id="cos">cos()</h2>
<p>sin() 이 있으면 cos()는 간단히 구현할 수 있다.
<code>cos(x)</code>를 구하고 싶으면 <code>sin(x + 90도)</code> 를 계산하면 된다.
그런데 DOOM은 sine계산에는 lookup table 조회 한번이면 충분한데 cosine 계산에는 덧셈도 필요한게 성능을 까먹는다고 생각했는지 재밌는 기법을 이용했다.</p>
<ol>
<li>sine lookup table은 0~360도 구간이 아니라 90도를 더 계산해서 450도까지 계산한다. <code>finesine[5*FINEANGLES/4]</code></li>
<li>cosine lookup table의 주소값은 sine lookup table보다 90도 만큼 뒤를 가르킨다.</li>
<li>sine 쓰듯이 cosine을 쓰면 된다.</li>
</ol>
<pre><code class="language-c">// table.h
// Re-use data, is just PI/2 pahse shift.
extern  fixed_t*	finecosine;

// r_main.c
fixed_t*		finecosine = &amp;finesine[FINEANGLES/4];
</code></pre>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="http://fabiensanglard.net/doomIphone/doomClassicRenderer.php">DOOM ENGINE CODE REVIEW</a></li>
<li><a href="https://en.wikipedia.org/wiki/Binary_scaling">Binary scaling</a></li>
</ul>

    </section>

    <ul class="articles-timeline">
      <li class="previous-article">
        
        <a href="https://libsora.so/posts/maya-markdown-preprocessor-post-mortem/" title="Next: Maya (Markdown 전처리기) 포스트모템">
          Maya (Markdown 전처리기) 포스트모템
          
          <br/><small>Template -&gt; Markdown Preprocessor -&gt; Markdown</small>
          
        </a>
        
      </li>

      <li class="next-article">
        
        <a href="https://libsora.so/posts/golang-package-management-failure-learned-from-github-kr-text/" title="Previous: golang 패키지 관리의 약점과 대응책">
          golang 패키지 관리의 약점과 대응책
          
          <br/><small>left-pad, 그것의 npm만의 문제인가? 그리고 golang의 해결법</small>
          
        </a>
        
      </li>
    </ul>

    <section class="entry-content">
      <section class="disqus-section">
<h1 hidden>Comment</h1>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var host = "libsora.so";
  if (host == window.location.host) {
    var disqus_shortname = 'libsora';
    var disqus_identifier = 'http://libsora.so\/posts\/angle-and-sine-doom-version\/';

    (function() {
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  } else {
    console.log("skip disqus");
  }
</script>
<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="//disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

    </section>
  </article>
</div>

<footer class="footer">
  <ul class="nav-link-list">
    
    
    
    <li>
      
      <a href="//twitter.com/if1live" title="Twitter"><i class="fa fa-twitter"> </i></a>
    </li>
    
    
    
    <li>
      
      <a href="//github.com/if1live" title="GitHub"><i class="fa fa-github"> </i></a>
    </li>
    
    
    
    <li>
      
      <a href="//bitbucket.org/if1live" title="BitBucket"><i class="fa fa-bitbucket"> </i></a>
    </li>
    

    <li>
      
      <a href="https://libsora.so/index.xml"><i class="fa fa-rss"> </i></a>
    </li>

    
  </ul>

  <p>
    <a href="//gohugo.io/" title="Hugo">Hugo</a> |
    
    <a href="//twitter.com/if1live/" title="@if1live">@if1live</a>
    
  </p>
</footer>

<script src="/js/common.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/prism.min.js"
  integrity="sha512-9+422Bs3A87UkWfp+qV80Nfv9arhbCXKY1rxrF2seorI36mIIstMiuBfyKLF1yH1nnzQkEWq2xrzT4XU3Z+vrA=="
  crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/line-numbers/prism-line-numbers.min.js"
  integrity="sha512-1oLZvExT5RaW4q2GgvRPf+XzVVGmsKirfZBRN7aifdOpvZ1L9idEncfMFlfHiQNGBA+Sev+alscSAT/xQ0rwXA=="
  crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-clike.min.js"
  integrity="sha512-/WJ9ZNER39LEXW4XzFoMR6ct++/HT++A71MDW2gBbUJExj8hFRtde5Q5QzcHyBMxU97VeH1wEHGBRtNuGJpV4w=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-c.min.js"
  integrity="sha512-TO7UeOg1N67oP7UU2OzrOm0oZrTz2TXGNRtkf/x+d9Pt5O8cb5jeSRcryiXqW/Nd25VEc8Qqtu8Dx1EVV7AJLQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-cpp.min.js"
  integrity="sha512-dzF2RO45FHCMPdWDQ3I7Cn9xPvCM8x8T4ODz+kSPQl5CAuIMy6Ekb2i2DAjLEpG/V/DL9f/O7+9E/HZQQx89IA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-typescript.min.js"
  integrity="sha512-5KnWNKu6jz8OE4nIBndz3PZ4O3RGqcPNcsyEFZkx3F5N8liSwc3bCe4qPOa/a3+e4CxVl0izHMXeZ0Z4yk7LTA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-python.min.js"
  integrity="sha512-EXseTM1JV8e3AonU5PfOUmzbPkUTRm4c4hVxv206gVeWZE/FwzSQBNWrUBaHsN3Idq9k76BEjUlXpluX1UFx6Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-javascript.min.js"
  integrity="sha512-UN3RxBb1KfsWQUMNl19SU/JPer3v8jTBpfGyQaBEuaVjP5q0Gz9ihj8MiHEUZYnc1krYRm5imVebjq1egsSaKA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-java.min.js"
  integrity="sha512-p2vAaPEsPvlIESCpoEI5IyzZowfdVZ2O39PsrOrkuTQl+AjD57T4L/Wxv5S8WCToLou0twQZaWO+tt660Rqb6Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-csharp.min.js"
  integrity="sha512-qvSIQfI/qEeMC1E1LMSPCsDl8vFzl0rkBfF6dDcnMJxQT+8M2WjSyDGqHQzZa+RChv3jkdKnZAo99BcAbGsnQg=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-bash.min.js"
  integrity="sha512-CILPDr/8BlkkElCeI+f2yMu0fzgwWqpQ0Cdr0busFfySJJ4SoCRivbT6+Z+SWPkjWwBil9NO0tHd6NSfpwiQaA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-ruby.min.js"
  integrity="sha512-Wgi0cnFpl5EY8xLe1RO+uTsot86wzAbW/BIoqZopPU+8YW79VDqQE9qTe1R+1uhxLsPBHE+nYwACS+eTsE5GtQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-go.min.js"
  integrity="sha512-hVtwzUDz/n7RqQmiQ7xYAJCTTJe5C52Ung+4Kpz2fPRq7nq2h5gHHQe2HRy7f1Tj3OUVgTO5WRx7XuwT624C9Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-less.min.js"
  integrity="sha512-REVnwsprLWmQbtt0WjkS59nMvtKE0olIjUx+N/k3Gqa5WhmrZ7o0ahGhKYnIK6W2+ITg4cQ2UqZkka4RaZSM9Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-scss.min.js"
  integrity="sha512-rAb9BrnkhMpxN7NoOM7WwPa3phfCMMUZw568Tyzlj9frNsdUUeltfCTATD6ccnVLtnERR+ZXS85Ybs7wo9IiTQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-css.min.js"
  integrity="sha512-zDjwO/e5eVa5WfYra8CE827RFyA/nqhp8y4da+geEpAqpCnmfAHopCNobQ9sJeLBMQY0OLB+hT+k6bbb0FhdYQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-json.min.js"
  integrity="sha512-IC7rV8RslChgByOdUFC6ePqOGn+OwJhnKC3S5AezM8DAiOdGhJMwgsIvBChsa2yuxxoPbH2+W/kjNUM1cc+jUQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-yaml.min.js"
  integrity="sha512-j9sRnEoasdNn9OSwsCxjrQi1H55NqBFDJ+oe7me3sIfvDLeTyzvnZXf0eJqL5CvX6rswU2Sld9PnTVQ0Xy2CFQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-batch.min.js"
  integrity="sha512-YzSVmlznJS4QEi5/tSS9iZ/tVFGdQSKO/F2jsofNH+5PifywJfsOtOZaia+URhumCMdXTTG2UZQ4vtBHWids+Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-lisp.min.js"
  integrity="sha512-3c6jwEnUKsrvucb8b9xdDJw13zOdbeP83PvlSKeoTCCWGacG03MUWHCcBev2NKHA+w8IAWZsGXBcNMaIH/VWYA=="
  crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.3/mermaid.min.js"
  integrity="sha512-+TNmhaRJf3jyYHTpzEq/5I6b+aGyhzWb21mGdHAjxSGSYwxN9Grug3Y3B9qVxWfKKY8MscE/6mr9walWvFLFvQ=="
  crossorigin="anonymous"></script>

<script>
  mermaid.initialize({ startOnLoad: true });

  (function () {
    const elems = document.querySelectorAll('code.language-mermaid');
    for (let i = 0; i < elems.length; i++) {
      const id = `mermaid-${i}`;
      const elem = elems[i];
      const source = elem.innerText;
      const cb = (svg) => {
        const div = document.createElement('div');
        div.innerHTML = svg;
        elem.parentElement.replaceWith(div);
      };
      mermaid.render(id, source, cb);
    }
  })();
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js"
  integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg=="
  crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js"
  integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg=="
  crossorigin="anonymous"></script>

<script>
  renderMathInElement(document.body,
    {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    }
  );

  var inlineMathArray = document.querySelectorAll("script[type='math/tex']");
  for (var i = 0; i < inlineMathArray.length; i++) {
    var inlineMath = inlineMathArray[i];
    var tex = inlineMath.innerText || inlineMath.textContent;
    var replaced = document.createElement("span");
    replaced.innerHTML = katex.renderToString(tex, { displayMode: false });
    inlineMath.parentNode.replaceChild(replaced, inlineMath);
  }

  var displayMathArray = document.querySelectorAll("script[type='math/tex; mode=display']");
  for (var i = 0; i < displayMathArray.length; i++) {
    var displayMath = displayMathArray[i];
    var tex = displayMath.innerHTML;
    var replaced = document.createElement("span");
    replaced.innerHTML = katex.renderToString(tex.replace(/%.*/g, ''), { displayMode: true });
    displayMath.parentNode.replaceChild(replaced, displayMath);
  }
</script>


<script>
  var host = "libsora.so";
  if (host == window.location.host) {
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-37862172-2','auto');ga('send','pageview')
  } else {
    console.log("skip google analytics");
  }
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>


</body>
</html>

