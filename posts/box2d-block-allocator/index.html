<!doctype html>
<html class="no-js" lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Hugo 0.78.1" />

  <title> Box2d Block Allocator &middot; /usr/lib/libsora.so </title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="naver-site-verification" content="2ddc1a56777489f4a64a4f6a59822f8b1c1ea502"/>
  <meta name="google-site-verification" content="VsvNNnJZUV-iLEYKNju16p-HtDqZeqL15H-VVy-HwpA" />

  <meta name="gc:client-id" content="785d47c81cbc2fd42b65">
  <meta name="gc:client-secret" content="5e5d558f0b16fae154aa47fc9d94f7c09e540ec7">

  
  <meta name="author" content="if1live" />
  

  
  <meta name="description" content="Box2d Block Allocator" />
  

  
  <meta name="keywords" content="box2d, allocator" />
  

  
  
<meta name="twitter:card" content="summary">
<meta name="og:url" content="https://libsora.so/posts/box2d-block-allocator/">

<meta name="twitter:site" content="@if1live">


<meta name="twitter:title" content="Box2d Block Allocator">
<meta name="twitter:description" content="작은크기의 객체를 많이 할당할때 사용되는 할당자이다. 기본설정값의 경우, 대략 640byte보다 작은 메모리를 많이 요청할때 사용한다
기본 구조 Chunk, Block의 2가지 개념으로 나누어서 메모리를 관리한다. Chunk는 16kb(기본값)을 하나의 크기로 가짆다. Chunk는 하나의 거대한 메모리 덩어리이고 이를 적절히 block이라든 작은 단위로 잘">

<meta name="twitter:image:src" content="https://www.gravatar.com/avatar/fb9672e7e0d256f39369595381d1ea07">



  

  
  
  <link rel="stylesheet" href="https://libsora.so/css/style-gen.css?2">

  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

  
  <link href="https://libsora.so/index.xml" rel="alternate" type="application/rss+xml" title="/usr/lib/libsora.so" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/themes/prism.min.css"
  integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ=="
  crossorigin="anonymous" />
<link rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/line-numbers/prism-line-numbers.min.css"
  integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ=="
  crossorigin="anonymous" />

  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css"
  integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw=="
  crossorigin="anonymous" />


  
  <script type="text/javascript">
    var host = "libsora.so";
    if ((host == window.location.host) && (window.location.protocol != "https:")) {
      window.location.protocol = "https";
    } else {
      console.log("skip https redirect");
    }
  </script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: "ca-pub-3043297488880636",
  enable_page_level_ads: true
});
</script>

</head>
<body>

<header class="header">
  <h1 class="font-monospace">
    <a href="https://libsora.so/">/usr/lib/libsora.so</a>
  </h1>
  <nav>
    <h2 hidden>Navigation</h2>
    <ul class="nav-link-list">
      <li>
        <a href="https://libsora.so/about/"  title="about">
          <i class="fa fa-info"><span hidden>about</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/projects/"  title="projects">
          <i class="fa fa-code"><span hidden>projects</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/archives/"  title="archives">
          <i class="fa fa-archive"><span hidden>Archives</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/tags/"  title="tags">
          <i class="fa fa-tags"><span hidden>Tags</span></i>
        </a>
      </li>
      <li>
        <a href="https://libsora.so/search/"  title="search">
          <i class="fa fa-search"><span hidden>Search</span></i>
        </a>
      </li>
    </ul>
  </nav>
</header>


<div class="container">
  <article class="basic-content article-content">
    <header>
      <hgroup class="entry-title">
        <a href="/posts/box2d-block-allocator/" rel="bookmark" title="Permalink to Box2d Block Allocator">
          <h1>Box2d Block Allocator</h1>
          
        </a>
      </hgroup>
    </header>

    <footer class="post-info">
      <abbr class="published" title='2013-01-25T00:00:00Z'>
        2013/01/25
      </abbr>
      
      <address class="vcard author">
        By <a href="//twitter.com/if1live">@if1live</a>
      </address>
      

      <ul class="list-of-tags tags-in-article">
        
        <li>
          <a href="/tags/box2d">#box2d</a>
        </li>
        
        <li>
          <a href="/tags/allocator">#allocator</a>
        </li>
        
      </ul>
    </footer>

    <section class="entry-content">
      <p>작은크기의 객체를 많이 할당할때 사용되는 할당자이다. 기본설정값의 경우, 대략 640byte보다 작은 메모리를 많이 요청할때 사용한다</p>
<h2 id="기본-구조">기본 구조</h2>
<p>Chunk, Block의 2가지 개념으로 나누어서 메모리를 관리한다. Chunk는 16kb(기본값)을 하나의 크기로 가짆다. Chunk는 하나의 거대한 메모리 덩어리이고 이를 적절히 block이라든 작은 단위로 잘라서 사용한다.</p>
<p>메모리를 몇 byte로 요청하든간에 정해진 크기의 메모리로 할당한다. 같은 크기의 메모리블럭을 모아서 관리하기 위한 편법으로 이를 채택한듯하다. 허용 가능한 메모리 할당 크기는 s_blockSizes에 정의되어잇다. 16, 13, 64, &hellip;.640 등이 가능하다.</p>
<p>메모리 할당 요청이 들어오면 m_freeLists를 사용해서 미리 할당된 메모리중에서 쪼개서 줄수잇다. m_freeLists는 blockSizes크기의 배열이다. 즉, 16, 32, 64&hellip;에 1:1로 대응되는 포인터를 저장한다.</p>
<p>s_blockSizeLookup에는 바이트별로 m_freeLists, s_blockSizes에 대응되는 인덱스를 가진다. 예를 들어서 3byte의 메모리를 요청하면 block allocator는 16byte의 메모리를 반환한다. 그렇다면 &lsquo;3&rsquo;을 값으로 넣으면 16byte에 대응되는 인덱스값이 &lsquo;0&rsquo;을 바로 얻을수 잇으면 여러모로 편할것이다. 그래서 이 변수가 생겻다. s_blockSizeLookup는 b2_maxBlockSize+1 크기의 배열이라서 0byte~b2_maxBlockSize byte에 1:1로 대응되는 블럭크기 인덱스를 저장한다.</p>
<pre><code class="language-cpp">struct b2Chunk
{
	int32 blockSize;
	b2Block* blocks;
};
</code></pre>
<p>Chunk를 나타내는 구조체이다. 할당한 16kb의 메모리 블럭은 blocks가 가리킨다. blockSize로 Chunk가 처리할 메모리블럭의 크기를 표현한다(16, 32,,같은 s_blockSizes에 잇는 값) 디버깅용으로 쓰이지 실제 로직상에서는 blockSize를 직접 확인하지는 않는다</p>
<pre><code class="language-cpp">struct b2Block
{
	b2Block* next;
};
</code></pre>
<p>Block를 나타내는 구조체이다. 내부에서 연산할때만 쓰이고 실제로 외부에서 메모리를 할당받아서 쓸때는 next값을 덮어써서 작업한다</p>
<h2 id="malloc">Malloc</h2>
<p>실제 로직이전에 처리되는 정책</p>
<ul>
<li>0byte를 요쳥하면 NULL</li>
<li>b2_maxBlockSize보다 큰 메모리를 요청하면 표준 malloc를 사용</li>
</ul>
<h3 id="원하는-크기의-블럭으로-이미-할당된-것이-남아잇는-경우">원하는 크기의 블럭으로 이미 할당된 것이 남아잇는 경우</h3>
<pre><code class="language-cpp">int32 index = s_blockSizeLookup[size];
if (m_freeLists[index]) {
	b2Block* block = m_freeLists[index];
	m_freeLists[index] = block-&gt;next;
	return block;
}
</code></pre>
<p>할당가능할것을 반환하고 이전의 블럭이 가리키는 next를 새로운 freeList로 설정한다. block간의 연결은 block=&gt;block=&gt;NULL 로 해놓기 때문에 가능한것을 전부사용하면 최종적으로는 NULL이 되서 다른 로직으로 진입하게 된다</p>
<h3 id="원하는-크기의-블럭이-할당되어잇지-않은-경우">원하는 크기의 블럭이 할당되어잇지 않은 경우</h3>
<pre><code class="language-cpp">int32 index = s_blockSizeLookup[size];

if (m_freeLists[index] == false) {
	if (m_chunkCount == m_chunkSpace) {
		b2Chunk* oldChunks = m_chunks;
		m_chunkSpace += b2_chunkArrayIncrement;
		m_chunks = (b2Chunk*)b2Alloc(m_chunkSpace * sizeof(b2Chunk));
		memcpy(m_chunks, oldChunks, m_chunkCount * sizeof(b2Chunk));
		memset(m_chunks + m_chunkCount, 0, b2_chunkArrayIncrement * sizeof(b2Chunk));
		b2Free(oldChunks);
	}

	b2Chunk* chunk = m_chunks + m_chunkCount;
	chunk-&gt;blocks = (b2Block*)b2Alloc(b2_chunkSize);
#if defined(_DEBUG)
	memset(chunk-&gt;blocks, 0xcd, b2_chunkSize);
#endif
	int32 blockSize = s_blockSizes[index];
	chunk-&gt;blockSize = blockSize;
	int32 blockCount = b2_chunkSize / blockSize;
	b2Assert(blockCount * blockSize &lt;= b2_chunkSize);
	for (int32 i = 0; i &lt; blockCount - 1; ++i) {
		b2Block* block = (b2Block*)((int8*)chunk-&gt;blocks + blockSize * i);
		b2Block* next = (b2Block*)((int8*)chunk-&gt;blocks + blockSize * (i + 1));
		block-&gt;next = next;
	}
	b2Block* last = (b2Block*)((int8*)chunk-&gt;blocks + blockSize * (blockCount - 1));
	last-&gt;next = NULL;

	m_freeLists[index] = chunk-&gt;blocks-&gt;next;
	++m_chunkCount;

	return chunk-&gt;blocks;
}
</code></pre>
<p>새로운 chunk를 생성하고 이것으로 원하는 크기의 블럭을 관리한다. Chunk 저장 여유분이 떨어진 경우, 새로운 Chunk배열을 할당한다.</p>
<ol>
<li>새로 사용할 Chunk의 포인터를 얻는다.</li>
<li>Chunks에서 사용할 block 데이터를 할당한다. b2_chunkSize(16kb)를 할당한다</li>
<li>chunks가 커버할 block size를 저장한다. 디버깅에서나 쓰인다</li>
<li>blocks를 block size로 쪼갠다. 그리고 각각의 조각을 싱글 링크드 리스트 느낌으로 연결한다. block=&gt;block=&gt;block=&gt;&hellip;=&gt;NULL</li>
<li>chunk 사용수를 늘린다</li>
<li>freeList에 새로 할당한 블럭리스트중에서 2번째것을 넣는다</li>
<li>새로 할당한 블럭리스트중에서 첫번째꺼를 반환한다</li>
</ol>
<h2 id="free">Free</h2>
<p>읽기 쉽게 하기위해서 디버깅용 코드는 날렷다. 전체소스는 원본코드를 참고한다.
로직전에 수행되는 정책</p>
<ul>
<li>size 0인 메모리를 해제하려고하면 그냥 리턴</li>
<li>음수 크기의 메모리는 해제 불가능</li>
<li>b2_maxBlockSize보다 큰 메모리는 표준 free를 사용한다 (이것은 malloc부분과 대응됨)</li>
</ul>
<pre><code class="language-cpp">int32 index = s_blockSizeLookup[size];
b2Block* block = (b2Block*)p;
block-&gt;next = m_freeLists[index];
m_freeLists[index] = block;
</code></pre>
<p>해제한 메모리 블럭을 m_freeLists의 첫번째 요소로 집어넣는다.</p>
<h2 id="clear">Clear</h2>
<p>Chunk에 연결된 블럭을 전부 해제한다.</p>
<h2 id="특징">특징</h2>
<ul>
<li>
<p>이상한 크기의 메모리를 요청한다고 하더라도 16, 32, 64byte같은 식으로 맞춰서 반환하기 때문에 아키텍쳐 특성을 타지 않는다.</p>
</li>
<li>
<p>작은 객체의 많은 할당에는 유리하다. Chunk의 크기가 기본적으로는 16kb이다. 블럭크기별로 볼때 다음과 같은 갯수의 데이터를 저장할수잇다. 많은 객체를 생성한다고 하더라도 실제로는 16kb단위로 할당해서 하기떄문에 시스템malloc의 호출횟수는 상당히 줄어든다.</p>
</li>
<li>
<p>원하는 크기의 블럭이 남아잇으면 한번에 메모리를 획득할수있다</p>
<ul>
<li>16byte : 1024개</li>
<li>32byte : 512개</li>
<li>64byte : 256개</li>
<li>96byte : 170개</li>
<li>128byte : 128개</li>
</ul>
</li>
<li>
<p>block마다 추가 데이터가 없다. block각각은 그냥 단순 포인터일뿐이다. block의 next를 저장하기는 하지만 그거는 임시값일뿐이고 실제로 외부에서 할당받아서 쓸때는 덮어써버린다.</p>
</li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li>
<p><a href="http://www.codeproject.com/Articles/17060/A-Fast-Efficient-Allocator-for-Small-Blocks-of-Mem">A Fast Efficient Allocatr for samll blocks of mem</a></p>
</li>
<li>
<p>box2d 소스</p>
<ul>
<li><a href="http://code.google.com/p/box2d/source/browse/trunk/Box2D/Box2D/Common/b2BlockAllocator.h">b2BlockAllocator.h</a></li>
<li><a href="http://code.google.com/p/box2d/source/browse/trunk/Box2D/Box2D/Common/b2BlockAllocator.cpp">b2BlockAllocator.cpp</a></li>
</ul>
</li>
</ul>

    </section>

    <ul class="articles-timeline">
      <li class="previous-article">
        
        <a href="https://libsora.so/posts/box2d-stack-allocator/" title="Next: Box2d Stack Allocator">
          Box2d Stack Allocator
          
        </a>
        
      </li>

      <li class="next-article">
        
        <a href="https://libsora.so/posts/auto-ptr/" title="Previous: auto_ptr을 썻는데 소멸자가 불리지 않는다?">
          auto_ptr을 썻는데 소멸자가 불리지 않는다?
          
        </a>
        
      </li>
    </ul>

    <section class="entry-content">
      <section class="disqus-section">
<h1 hidden>Comment</h1>
<div id="disqus_thread"></div>
<script type="text/javascript">
  var host = "libsora.so";
  if (host == window.location.host) {
    var disqus_shortname = 'libsora';
    var disqus_identifier = 'http://libsora.so\/posts\/box2d-block-allocator\/';

    (function() {
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  } else {
    console.log("skip disqus");
  }
</script>
<noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="//disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>

    </section>
  </article>
</div>

<footer class="footer">
  <ul class="nav-link-list">
    
    
    
    <li>
      
      <a href="//twitter.com/if1live" title="Twitter"><i class="fa fa-twitter"> </i></a>
    </li>
    
    
    
    <li>
      
      <a href="//github.com/if1live" title="GitHub"><i class="fa fa-github"> </i></a>
    </li>
    
    
    
    <li>
      
      <a href="//bitbucket.org/if1live" title="BitBucket"><i class="fa fa-bitbucket"> </i></a>
    </li>
    

    <li>
      
      <a href="https://libsora.so/index.xml"><i class="fa fa-rss"> </i></a>
    </li>

    
  </ul>

  <p>
    <a href="//gohugo.io/" title="Hugo">Hugo</a> |
    
    <a href="//twitter.com/if1live/" title="@if1live">@if1live</a>
    
  </p>
</footer>

<script src="/js/common.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/prism.min.js"
  integrity="sha512-9+422Bs3A87UkWfp+qV80Nfv9arhbCXKY1rxrF2seorI36mIIstMiuBfyKLF1yH1nnzQkEWq2xrzT4XU3Z+vrA=="
  crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/plugins/line-numbers/prism-line-numbers.min.js"
  integrity="sha512-1oLZvExT5RaW4q2GgvRPf+XzVVGmsKirfZBRN7aifdOpvZ1L9idEncfMFlfHiQNGBA+Sev+alscSAT/xQ0rwXA=="
  crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-clike.min.js"
  integrity="sha512-/WJ9ZNER39LEXW4XzFoMR6ct++/HT++A71MDW2gBbUJExj8hFRtde5Q5QzcHyBMxU97VeH1wEHGBRtNuGJpV4w=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-c.min.js"
  integrity="sha512-TO7UeOg1N67oP7UU2OzrOm0oZrTz2TXGNRtkf/x+d9Pt5O8cb5jeSRcryiXqW/Nd25VEc8Qqtu8Dx1EVV7AJLQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-cpp.min.js"
  integrity="sha512-dzF2RO45FHCMPdWDQ3I7Cn9xPvCM8x8T4ODz+kSPQl5CAuIMy6Ekb2i2DAjLEpG/V/DL9f/O7+9E/HZQQx89IA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-typescript.min.js"
  integrity="sha512-5KnWNKu6jz8OE4nIBndz3PZ4O3RGqcPNcsyEFZkx3F5N8liSwc3bCe4qPOa/a3+e4CxVl0izHMXeZ0Z4yk7LTA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-python.min.js"
  integrity="sha512-EXseTM1JV8e3AonU5PfOUmzbPkUTRm4c4hVxv206gVeWZE/FwzSQBNWrUBaHsN3Idq9k76BEjUlXpluX1UFx6Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-javascript.min.js"
  integrity="sha512-UN3RxBb1KfsWQUMNl19SU/JPer3v8jTBpfGyQaBEuaVjP5q0Gz9ihj8MiHEUZYnc1krYRm5imVebjq1egsSaKA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-java.min.js"
  integrity="sha512-p2vAaPEsPvlIESCpoEI5IyzZowfdVZ2O39PsrOrkuTQl+AjD57T4L/Wxv5S8WCToLou0twQZaWO+tt660Rqb6Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-csharp.min.js"
  integrity="sha512-qvSIQfI/qEeMC1E1LMSPCsDl8vFzl0rkBfF6dDcnMJxQT+8M2WjSyDGqHQzZa+RChv3jkdKnZAo99BcAbGsnQg=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-bash.min.js"
  integrity="sha512-CILPDr/8BlkkElCeI+f2yMu0fzgwWqpQ0Cdr0busFfySJJ4SoCRivbT6+Z+SWPkjWwBil9NO0tHd6NSfpwiQaA=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-ruby.min.js"
  integrity="sha512-Wgi0cnFpl5EY8xLe1RO+uTsot86wzAbW/BIoqZopPU+8YW79VDqQE9qTe1R+1uhxLsPBHE+nYwACS+eTsE5GtQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-go.min.js"
  integrity="sha512-hVtwzUDz/n7RqQmiQ7xYAJCTTJe5C52Ung+4Kpz2fPRq7nq2h5gHHQe2HRy7f1Tj3OUVgTO5WRx7XuwT624C9Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-less.min.js"
  integrity="sha512-REVnwsprLWmQbtt0WjkS59nMvtKE0olIjUx+N/k3Gqa5WhmrZ7o0ahGhKYnIK6W2+ITg4cQ2UqZkka4RaZSM9Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-scss.min.js"
  integrity="sha512-rAb9BrnkhMpxN7NoOM7WwPa3phfCMMUZw568Tyzlj9frNsdUUeltfCTATD6ccnVLtnERR+ZXS85Ybs7wo9IiTQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-css.min.js"
  integrity="sha512-zDjwO/e5eVa5WfYra8CE827RFyA/nqhp8y4da+geEpAqpCnmfAHopCNobQ9sJeLBMQY0OLB+hT+k6bbb0FhdYQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-json.min.js"
  integrity="sha512-IC7rV8RslChgByOdUFC6ePqOGn+OwJhnKC3S5AezM8DAiOdGhJMwgsIvBChsa2yuxxoPbH2+W/kjNUM1cc+jUQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-yaml.min.js"
  integrity="sha512-j9sRnEoasdNn9OSwsCxjrQi1H55NqBFDJ+oe7me3sIfvDLeTyzvnZXf0eJqL5CvX6rswU2Sld9PnTVQ0Xy2CFQ=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-batch.min.js"
  integrity="sha512-YzSVmlznJS4QEi5/tSS9iZ/tVFGdQSKO/F2jsofNH+5PifywJfsOtOZaia+URhumCMdXTTG2UZQ4vtBHWids+Q=="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.22.0/components/prism-lisp.min.js"
  integrity="sha512-3c6jwEnUKsrvucb8b9xdDJw13zOdbeP83PvlSKeoTCCWGacG03MUWHCcBev2NKHA+w8IAWZsGXBcNMaIH/VWYA=="
  crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.3/mermaid.min.js"
  integrity="sha512-+TNmhaRJf3jyYHTpzEq/5I6b+aGyhzWb21mGdHAjxSGSYwxN9Grug3Y3B9qVxWfKKY8MscE/6mr9walWvFLFvQ=="
  crossorigin="anonymous"></script>

<script>
  mermaid.initialize({ startOnLoad: true });

  (function () {
    const elems = document.querySelectorAll('code.language-mermaid');
    for (let i = 0; i < elems.length; i++) {
      const id = `mermaid-${i}`;
      const elem = elems[i];
      const source = elem.innerText;
      const cb = (svg) => {
        const div = document.createElement('div');
        div.innerHTML = svg;
        elem.parentElement.replaceWith(div);
      };
      mermaid.render(id, source, cb);
    }
  })();
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js"
  integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg=="
  crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js"
  integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg=="
  crossorigin="anonymous"></script>

<script>
  renderMathInElement(document.body,
    {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
      ]
    }
  );

  var inlineMathArray = document.querySelectorAll("script[type='math/tex']");
  for (var i = 0; i < inlineMathArray.length; i++) {
    var inlineMath = inlineMathArray[i];
    var tex = inlineMath.innerText || inlineMath.textContent;
    var replaced = document.createElement("span");
    replaced.innerHTML = katex.renderToString(tex, { displayMode: false });
    inlineMath.parentNode.replaceChild(replaced, inlineMath);
  }

  var displayMathArray = document.querySelectorAll("script[type='math/tex; mode=display']");
  for (var i = 0; i < displayMathArray.length; i++) {
    var displayMath = displayMathArray[i];
    var tex = displayMath.innerHTML;
    var replaced = document.createElement("span");
    replaced.innerHTML = katex.renderToString(tex.replace(/%.*/g, ''), { displayMode: true });
    displayMath.parentNode.replaceChild(replaced, displayMath);
  }
</script>


<script>
  var host = "libsora.so";
  if (host == window.location.host) {
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-37862172-2','auto');ga('send','pageview')
  } else {
    console.log("skip google analytics");
  }
</script>
<script src="https://www.google-analytics.com/analytics.js" async defer></script>


</body>
</html>

